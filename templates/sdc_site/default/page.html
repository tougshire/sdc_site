{% extends './_base.html'%}
{% load touglates_tags %}
{% load sdc_site_extras %}
{% block content %}
{% for section in page.section_set.all %}
  <div class="section">
    {% if section.content_before %}
      <div class="section_content">
      {{ section.content_before|safe }}
      </div>
    {% endif %}
    {% if section.sectioncase_set.all %}
    <div class="cases">
      {% for sectioncase in section.sectioncase_set.all %}
      <div class="case-wrapper" data-width="{{ sectioncase.case.width }}">
        <div class="case" id="case_{{ sectioncase.pk }}">
          {% if section.case.content_above_articles %}
            <div class="case-content">
            {{ sectioncase.case.content_above_articles|safe }}
            </div>
          {% endif %}
          {% for article in sectioncase.case.article_set.all %}
            <div class="article" id="article_{{ article.pk }}">
              <h2>{{ article.title }}</h2>
              <div class="{{ article.content_classes }}" >
                {{ article.content|render_with_format:article.content_format|safe }}
                {% if article.iframe_src %}
                  <iframe src="{% get_from_iframe_src article.iframe_src 'src' %}" height="{% get_from_iframe_src article.iframe_src 'height' %}"></iframe>
                {% endif %}
                </div>
            </div>
          {% endfor %}
          {% if section.case.content_below_articles %}
            <div class="case-content">
            {{ sectioncase.case.content_below_articles|safe }}
            </div>
          {% endif %}

        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %}
    {% if section.content_after|safe %}
      <div class="section_content">
      {{ section.content_after }}
      </div>
    {% endif %}

  </div>
{% endfor %}
<script>
  function resizeCases() {
    if(window.innerWidth > 600) {
      var sections = document.getElementsByClassName("section")
      for(var section of sections) {
        var cases = section.getElementsByClassName("case-wrapper")
        var total_widths = 0
        for(var case of cases) {
          total_widths += parseInt(case.dataset["width"])
        }
        for(var case of cases) {
          case.style.width = (( 80/total_widths) * case.dataset["width"] ) + "%"
        }
      }
    } else {
      var cases = document.getElementsByClassName("case-wrapper")
      for(var case of cases) {
        case.style.width="90%"
      }
    }
  }
  resizeCases()
  window.addEventListener("resize", resizeCases);
</script>

{% endblock %}
